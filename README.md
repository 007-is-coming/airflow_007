# airflow_007

# ì˜¥íƒ‘ë°© í”Œë¦¬ ğŸ§

**`3ì°¨ 7íŒ€ â€˜007**â€™ **| ê¶Œì°¬ì†¡, ê¹€ìœ¤ì •, ì´ë¯¼ì§€, ì „ìˆ˜ë¯¼, ì†¡ê¸°ì›…, ìµœí˜œë¦¼**`

## I. í”„ë¡œì íŠ¸ ë°°ê²½ ë° ëª©í‘œ

<aside>

### **ğŸ” ê¸°ì¡´ ìŒì› ì‚¬ì´íŠ¸ì˜ ìŒì•… ì¶”ì²œ ê¸°ëŠ¥ì˜ í•œê³„**

- í•˜ë‚˜ì˜ ìŒì› ì‚¬ì´íŠ¸ ë‚´ì—ì„œë§Œ ëˆ„ì ëœ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë…¸ë˜ë¥¼ ì¶”ì²œ ë°›ì„ ìˆ˜ ìˆìŒ
- ë‚´ê°€ ì›í•˜ëŠ” ë…¸ë˜ í•œ ê³¡ì— ëŒ€í•´ ì—¬ëŸ¬ê°€ì§€ ì‚¬ì´íŠ¸ì—ì„œ ì¶”ì²œí•˜ëŠ” ë…¸ë˜ë¥¼ ì°¾ê¸° í˜ë“¦

### **ğŸ‘¤ ë‹¤ì–‘í•œ í”Œë«í¼ì˜ ë°ì´í„°ë¥¼ í™œìš©í•œ í†µí•© ì¶”ì²œ**

- ìœ íŠœë¸Œì™€ ìŠ¤í¬í‹°íŒŒì´ì˜ ê°•ì ì„ ê²°í•©í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ **`í•œ í”Œë«í¼ì„ ë„˜ì–´ì„  í­ë„“ì€ ì¶”ì²œ ì„œë¹„ìŠ¤`** ì œê³µ
- ê° í”Œë«í¼ì˜ íŠ¹ì„±(ì»¤ë²„ê³¡, ì „ë¬¸ íë ˆì´íŒ… ë“±)ì„ ë°˜ì˜í•œ **`ìµœì í™”ëœ ì¶”ì²œ ê²½í—˜`** ì œê³µ
</aside>

## II. í™œìš© ê¸°ìˆ  ë° í”„ë¡œì íŠ¸ êµ¬ì¡°

<aside>

| TASK | í™œìš© ê¸°ìˆ  | ë¹„ê³  |
| --- | --- | --- |
| Data Collection | Python, SQL | **`Spotify API`**, **`Youtube API`**ì‚¬ìš© |
| Data Preprocessing | Python, SQL | API í˜¸ì¶œ í›„ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ê²Œ ë³€ê²½ |
| Data Warehouse(DB) | On-premise  | **`Postgre`** APIë¥¼ í†µí•´ ê°€ì§€ê³  ì˜¨ ë°ì´í„° ì ì¬ |
| Visualization | Django | **`Web Page`** ê²€ìƒ‰ ë° ì¶”ì²œ ê²°ê³¼ ì¶œë ¥ |
| Team Management | Notion, Discord, Github, VSCode | **`Notion`**í”„ë¡œì íŠ¸ íšŒì˜ ê¸°ë¡, í”„ë¡œì íŠ¸ ë³´ê³ ì„œ ì‘ì„±
**`Discord`** í”„ë¡œì íŠ¸ íšŒì˜ ë° ì‹¤ì‹œê°„ ê³µìœ 
**`Github`** í”„ë¡œì íŠ¸ ê²°ê³¼ë¬¼ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
**`VSCode`** live shareë¥¼ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì½”ë“œ ê³µìœ  ë° í˜‘ì—… |

### âš™ System Architecture
![á„ƒá…¦á„‹á…µá„á…¥ á„‹á…¡á„á…µá„á…¦á†¨ã…Š](https://github.com/user-attachments/assets/45b04a82-6f4b-4872-8a2e-3bca35d72ac9)

</aside>

## III. ê²°ê³¼ë¬¼

### **ğŸ“Š Web Page Demonstration Video**

<aside>

- **`Demonstration video`**
    
    [á„’á…ªá„†á…§á†« á„€á…µá„…á…©á†¨ 2024-11-27 13.01.27.mov](https://prod-files-secure.s3.us-west-2.amazonaws.com/29dd0948-7b38-443b-af5a-c6bc908226ab/2b6e86d3-adff-4c0a-ab1c-9dbaf98174d5/%E1%84%92%E1%85%AA%E1%84%86%E1%85%A7%E1%86%AB_%E1%84%80%E1%85%B5%E1%84%85%E1%85%A9%E1%86%A8_2024-11-27_13.01.27.mov)
    
</aside>

### **ğŸ“Š Web Page Screenshot**

<aside>

- **`Main`**
    
    ![á„†á…¦á„‹á…µá†«á„‘á…¦á„‹á…µá„Œá…µ](https://github.com/user-attachments/assets/8b796073-2778-476b-96d8-862318d77e06)

- **`Youtube`**
    
    ![á„‹á…²á„á…²á„‡á…³_á„‘á…¦á„‹á…µá„Œá…µ](https://github.com/user-attachments/assets/d82df897-dcf7-454d-b3f0-7e18146c4dd0)

    
- **`Spotify`**
    
    ![á„‰á…³á„‘á…©á„á…µá„‘á…¡á„‹á…µ_á„‘á…¦á„‹á…µá„Œá…µ](https://github.com/user-attachments/assets/85d0f6cb-c1f5-424c-9cad-bf488c1bee70)

    
- **`Play`**

    ![á„Œá…¢á„‰á…¢á†¼á„‘á…¦á„‹á…µá„Œá…µ](https://github.com/user-attachments/assets/6d3aabd6-2ff9-41f1-afb6-41fcbdb97e08)

</aside>

### **ğŸ“Š Presentation**

<aside>

https://www.canva.com/design/DAGXjmUbIOk/qWKyaSuho3Reux-sdDO_Vw/view

</aside>

## IV. í”„ë¡œì íŠ¸ ì„¸ë¶€ ë‚´ìš©

<aside>

### **ğŸ”¶ ERD**

![3.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/29dd0948-7b38-443b-af5a-c6bc908226ab/6062b889-cf0e-4942-8daf-b189404c3208/4e21d835-5db4-43bf-b9d2-1c2cf53790db.png)

### **âš’ ê°œë°œ ë‹¨ê³„ë³„ TASK**

- **Step1. ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬**
    - **ë°ì´í„° ìˆ˜ì§‘**
        
        
        | Data Name | Source | Update Date | Description |
        | --- | --- | --- | --- |
        | spotify_playlist | spotify api | trigger (django) ë°œìƒ ì‹œ  | ê²€ìƒ‰ì–´ì¸ ë…¸ë˜ë¥¼ í¬í•¨í•˜ëŠ” playlist |
        | spotify_recommend | spotify api | trigger (django) ë°œìƒ ì‹œ | ê²€ìƒ‰ì–´ì¸ ë…¸ë˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ recommendëœ ë…¸ë˜ |
        | search_youtube_playlist | youtube api | trigger (django) ë°œìƒ ì‹œ | ê²€ìƒ‰ì–´ì¸ ë…¸ë˜ë¥¼ í¬í•¨í•˜ëŠ” playlist (music ê²€ìƒ‰ì–´) |
        | search_youtube_video | youtube api | trigger (django) ë°œìƒ ì‹œ  | ê²€ìƒ‰ì–´ì¸ ë…¸ë˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ recommendëœ video (music ê²€ìƒ‰ì–´) |
        | spotify_today_tracks | spotify api | ë§¤ì¼ ìì • | ë§¤ì¼ global top 50ì—ì„œ ìƒìœ„ 10ê°œì˜ ë…¸ë˜  |
        | spotify_today_playlists | spotify api | ë§¤ì¼ ìì • | ë§¤ì¼ â€˜topâ€™ì„ í¬í•¨í•˜ëŠ” ìƒìœ„ 10ê°œì˜ playlist |
        | daily_youtube_video | youtube api | ë§¤ì¼ ìì • | ë§¤ì¼ global top video ì¤‘ ìƒìœ„ 10ê°œ (music ê²€ìƒ‰ì–´) |
    - **ë°ì´í„° ì „ì²˜ë¦¬**
        
        
        | Data Set | ê¸°ì¡´ Column | ì „ì²˜ë¦¬ í›„ Column | ì „ì²˜ë¦¬ ë‚´ìš© |
        | --- | --- | --- | --- |
        | spotify_playlist / search_youtube_playlist  | no, title, link, cover_image / no, playlist_title, playlist_id, playlist_thumbnail | no, playlist_title, playlist_url, thumbnail, platform | youtubeì™€ spotifyì—ì„œ ê°€ì§€ê³ ì˜¨ ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ í…Œì´ë¸”ë¡œ í†µí•© |
        | spotify_recommend / search_youtube_video | no, title, link, cover_image / no, video_title, video_id | no, song_title, song_url, thumbnail, platform | youtubeì™€ spotifyì—ì„œ ê°€ì§€ê³ ì˜¨ ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ í…Œì´ë¸”ë¡œ í†µí•© |
        | spotify_today_tracks / daily_youtube_video | no, title, link, cover_image /  no, video_title, video_id | no, song_title, song_url, thumbnail, platform | youtubeì™€ spotifyì—ì„œ ê°€ì§€ê³ ì˜¨ ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ í…Œì´ë¸”ë¡œ í†µí•© |
- **Step2. ë°ì´í„° ì ì¬**
    
    ğŸ“‹**Airflowë¥¼ í™œìš©í•œ Dag ì‚¬ìš©ìœ¼ë¡œ ë°ì´í„° ìë™ ì ì¬**
    
    > **`ğŸ“ˆ playlist_schema ë° django_schema ë°ì´í„° ì ì¬`**
    > 
    > - [**`daily_songs_dag.py`**] `Spotify ì˜¤ëŠ˜ì˜ Top 10 track ë° Youtube ì˜¤ëŠ˜ì˜ Top 10 video (ë§¤ì¼ ìì • ê°±ì‹ )`
    > - [**`spotify_today_playlists_dag.py`**] `Spotifyì˜ playlist ì¤‘ top í‚¤ì›Œë“œë¥¼ í¬í•¨í•˜ëŠ” playlist ì¤‘ ìƒìœ„ 10ê°œ (ë§¤ì¼ ìì • ê°±ì‹ )`


    > - [**`songs_dag.py`**] `ê²€ìƒ‰ì–´ ê¸°ë°˜ Spotify ì¶”ì²œ ìƒìœ„ 10ê°œ track / Spotify ì¶”ì²œ ëª©ë¡ 10ê°œ ê¸°ë°˜ Youtube ìƒìœ„ video (Django input trigger ê°±ì‹ )`
  
    > - [**`playlist_dag.py`**] `ê²€ìƒ‰ì–´ ê¸°ë°˜ Spotify ì¶”ì²œ ìƒìœ„ 10ê°œ playlist / ê²€ìƒ‰ì–´ ê¸°ë°˜ Youtube playlist ì¤‘ ìƒìœ„ 10ê°œ playlist (Django input trigger ê°±ì‹ )`
     
    > - [**`spotify_class.py`**] `spotify api ì‚¬ìš©ì„ ìœ„í•œ class`
 
    > - [**`youtube_class.py`**] `youtube api ì‚¬ìš©ì„ ìœ„í•œ class`
  
    
    ğŸ“‹**ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ë° ì ì¬**
    
    **[Schema] playlist_schema**
    
    > **`ğŸ“ˆ video, track, playlist ë°ì´í„° ì ì¬`**
    > 
    > - [**`spotify_today_tracks`**] `spotify ì˜¤ëŠ˜ì˜ Top 10 track`
    >     
    >     ```sql
    >     CREATE TABLE playlist_schema.spotify_today_tracks (
    >     	no	serial	NOT NULL,
    >     	title	VARCHAR(255)	NOT NULL,
    >     	link	VARCHAR(255)	NOT NULL,
    >     	cover_image	VARCHAR(255)	NOT NULL
    >     );
    >     ```
    >     
    > - [**`spotify_today_playlists`**] `spotify ì˜¤ëŠ˜ì˜ top playlist`
    >     
    >     ```sql
    >     CREATE TABLE playlist_schema.spotify_today_playlists (
    >     	no	serial	NOT NULL,
    >     	title	VARCHAR(255)	NOT NULL,
    >     	link	VARCHAR(255)	NOT NULL,
    >     	cover_image	VARCHAR(255)	NOT NULL
    >     );
    >     ```
    >     
    > - [**`spotify_playlist`**] `ê²€ìƒ‰ì–´ ê¸°ì¤€ spotify ì¶”ì²œ playlist`
    >     
    >     ```sql
    >     CREATE TABLE playlist_schema.spotify_playlist (
    >     	no	serial	NOT NULL,
    >     	title	VARCHAR(255)	NOT NULL,
    >     	link	VARCHAR(255)	NOT NULL,
    >     	cover_image	VARCHAR(255)	NOT NULL
    >     );
    >     ```
    >     
    > - [**`spotify_recommend`**] `ê²€ìƒ‰ì–´ ê¸°ì¤€ spotify ì¶”ì²œ track`
    >     
    >     ```sql
    >     CREATE TABLE playlist_schema.spotify_recommend (
    >     	no	serial	NOT NULL,
    >     	title	VARCHAR(255)	NOT NULL,
    >     	cover_image	VARCHAR(255)	NOT NULL
    >     );
    >     ```
    >     
    > - [**`daily_youtube_video`**] `youtube ì˜¤ëŠ˜ì˜ top video`
    >     
    >     ```sql
    >     CREATE TABLE playlist_schema.daily_youtube_video (
    >     	no	serial	NOT NULL,
    >     	video_title	VARCHAR(255)	NOT NULL,
    >     	video_id	VARCHAR(255)	NOT NULL
    >     );
    >     ```
    >     
    > - [**`search_youtube_playlist`**] `ê²€ìƒ‰ì–´ ê¸°ì¤€ youtube ì¶”ì²œ playlist`
    >     
    >     ```sql
    >     CREATE TABLE playlist_schema.search_youtube_playlist (
    >     	no	serial	NOT NULL,
    >     	playlist_title	VARCHAR(255)	NOT NULL,
    >     	playlist_id	VARCHAR(255)	NOT NULL,
    >     	playlist_thumbnail	VARCHAR(255)	NOT NULL
    >     );
    >     ```
    >     
    > - [**`search_youtube_video`**] `ê²€ìƒ‰ì–´ ê¸°ì¤€ youtube ì¶”ì²œ video`
    >     
    >     ```sql
    >     CREATE TABLE playlist_schema.search_youtube_video (
    >     	no	serial	NOT NULL,
    >     	video_title	VARCHAR(255)	NOT NULL,
    >     	video_id	VARCHAR(255)	NOT NULL
    >     );
    >     ```
    >     
    
    **[Schema] django_schema**
    
    > **`ğŸ“‰ Production DB`**
    > 
    > - [**`search_songs`**] `ê²€ìƒ‰ì–´ ê¸°ì¤€ spotify ì¶”ì²œ track ë° youtube ì¶”ì²œ video í†µí•©`
    >     
    >     ```sql
    >     CREATE TABLE django_schema.search_songs (
    >     	no	serial	NOT NULL,
    >     	song_title	VARCHAR(255)	NOT NULL,
    >     	song_url	VARCHAR(255)	NOT NULL,
    >     	thumbnail	VARCHAR(255)	NOT NULL,
    >     	platform	ENUM	NOT NULL
    >     );
    >     ```
    >     
    > - [**`search_playlist`**] `ê²€ìƒ‰ì–´ ê¸°ì¤€ spotify ë° youtube ì¶”ì²œ playlist í†µí•©`
    >     
    >     ```sql
    >     CREATE TABLE django_schema.search_playlist (
    >     	no	serial	NOT NULL,
    >     	playlist_title	VARCHAR(255)	NOT NULL,
    >     	playlist_url	VARCHAR(255)	NOT NULL,
    >     	thumbnail	VARCHAR(255)	NOT NULL,
    >     	platform	ENUM	NOT NULL
    >     );
    >     ```
    >     
    > - [**`daily_songs`**] `spotify ì˜¤ëŠ˜ì˜ top 10 ë° youtube ì˜¤ëŠ˜ì˜ top video í†µí•©`
    >     
    >     ```sql
    >     CREATE TABLE django_schema.daily_songs (
    >     	no	serial	NOT NULL,
    >     	song_title	VARCHAR(255)	NOT NULL,
    >     	song_url	VARCHAR(255)	NOT NULL,
    >     	thumbnail	VARCHAR(255)	NOT NULL,
    >     	platform	ENUM	NOT NULL
    >     );
    >     ```
    >     
    > - [**`daily_playlists`**] `spotify ë° youtube ì˜¤ëŠ˜ì˜ top playlist í†µí•©`
    >     
    >     ```sql
    >     CREATE TABLE django_schema.daily_playlists (
    >     	no	serial	NOT NULL,
    >     	playlist_title	VARCHAR(255)	NOT NULL,
    >     	playlist_url	VARCHAR(255)	NOT NULL,
    >     	thumbnail	VARCHAR(255)	NOT NULL,
    >     	platform	ENUM	NOT NULL
    >     );
    >     ```
    >     
- **Step3. ë°ì´í„° ì‹œê°í™” ë° Django (Web UI)**
    
    **ğŸ“Š ì˜¤ëŠ˜ì˜ Youtube, Spotify ì¶”ì²œ ê³¡ ë° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œê³µ**
    
    **ğŸ“Š ë…¸ë˜ ê²€ìƒ‰ ê¸°ë°˜ì˜ Youtube, Spotifiy ì¶”ì²œ ê³¡ ë° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œê³µ**
    
    **ë°±ì—”ë“œ (Model, View)**
    
    > **`ğŸ“‘ Model`**
    > 
    > - [**`models.py`**]
    >     
    >     ```python
    >     # í”Œë«í¼ ì„ íƒì§€ ENUM ì •ì˜
    >     class PlatformEnum(models.TextChoices):
    >     YOUTUBE = 'youtube', 'YouTube'
    >     SPOTIFY = 'spotify', 'Spotify'
    >     
    >     # DailySongs ëª¨ë¸
    >     class DailySongs(models.Model):
    >     no = models.AutoField(primary_key=True)
    >     song_title = models.CharField(max_length=255, verbose_name="Song Title")
    >     song_url = models.URLField(max_length=255, verbose_name="Song URL")
    >     thumbnail = models.URLField(max_length=255, null=True, blank=True, verbose_name="Thumbnail")
    >     platform = models.CharField(
    >     max_length=10,
    >     choices=PlatformEnum.choices,
    >     verbose_name="Platform",
    >     )
    >     
    >     class Meta:
    >         db_table = 'daily_songs'
    >         verbose_name = 'Daily Song'
    >         verbose_name_plural = 'Daily Songs'
    >     
    >     # DailyPlaylists ëª¨ë¸
    >     class DailyPlaylists(models.Model):
    >     no = models.AutoField(primary_key=True)  # ê¸°ë³¸ í‚¤ë¥¼ 'no'ë¡œ ì„¤ì •
    >     playlist_title = models.CharField(max_length=252, verbose_name="Playlist Title")
    >     playlist_url = models.URLField(max_length=255, verbose_name="Playlist URL")
    >     thumbnail = models.URLField(max_length=255, null=True, blank=True, verbose_name="Thumbnail")
    >     platform = models.CharField(
    >     max_length=10,
    >     choices=PlatformEnum.choices,
    >     verbose_name="Platform",
    >     )
    >     class Meta:
    >         db_table = 'daily_playlists'
    >         verbose_name = 'Daily Playlist'
    >         verbose_name_plural = 'Daily Playlists'
    >     
    >     # SearchSongs ëª¨ë¸
    >     class SearchSongs(models.Model):
    >     no = models.AutoField(primary_key=True)  # ê¸°ë³¸ í‚¤ë¥¼ 'no'ë¡œ ì„¤ì •
    >     song_title = models.CharField(max_length=255, verbose_name="Song Title")
    >     song_url = models.URLField(max_length=255, verbose_name="Song URL")
    >     thumbnail = models.URLField(max_length=255, null=True, blank=True, verbose_name="Thumbnail")
    >     platform = models.CharField(
    >     max_length=10,
    >     choices=PlatformEnum.choices,
    >     verbose_name="Platform",
    >     )
    >     class Meta:
    >         db_table = 'search_songs'
    >         verbose_name = 'Search Song'
    >         verbose_name_plural = 'Search Songs'
    >     
    >     # SearchPlaylist ëª¨ë¸
    >     class SearchPlaylist(models.Model):
    >     no = models.AutoField(primary_key=True)  # ê¸°ë³¸ í‚¤ë¥¼ 'no'ë¡œ ì„¤ì •
    >     playlist_title = models.CharField(max_length=252, verbose_name="Playlist Title")
    >     playlist_url = models.URLField(max_length=255, verbose_name="Playlist URL")
    >     thumbnail = models.URLField(max_length=255, null=True, blank=True, verbose_name="Thumbnail")
    >     platform = models.CharField(
    >     max_length=10,
    >     choices=PlatformEnum.choices,
    >     verbose_name="Platform",
    >     )
    >     
    >     class Meta:
    >         db_table = 'search_playlist'
    >         verbose_name = 'Search Playlist'
    >         verbose_name_plural = 'Search Playlists'
    >     ```
    >     
    > 
    >         `PostgreSQL db ëª¨ë¸ë§ ë° ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜`
    > 
    > **`ğŸ“‘ View`**
    > 
    > - [**`views.py`**]
    >     
    >     ```python
    >     from django.shortcuts import render, redirect
    >     from django.http import HttpResponse, JsonResponse
    >     from django.views.decorators.csrf import csrf_exempt
    >     from .models import DailySongs, DailyPlaylists, SearchSongs, SearchPlaylist
    >     import time
    >     
    >     def index(request):
    >         daily_songs = DailySongs.objects.all()
    >         daily_playlists = DailyPlaylists.objects.all()
    >     
    >         print(f"Daily Songs count: {daily_songs.count()}")
    >         print(f"Daily Playlists count: {daily_playlists.count()}")
    >     
    >         for song in daily_songs:
    >             print(f"Song: {song.song_title}, URL: {song.song_url}")
    >     
    >         for playlist in daily_playlists:
    >             playlist.playlist_url = playlist.playlist_url.replace("playlist", "embed/playlist")
    >     
    >         context = {
    >             'daily_songs': daily_songs,
    >             'daily_playlists': daily_playlists,
    >         }
    >         return render(request, 'search/index.html', context)
    >     
    >     import requests
    >     from requests.auth import HTTPBasicAuth
    >     
    >     @csrf_exempt
    >     def trigger_airflow_dag(request):
    >         if request.method == "POST":
    >             input_value = request.POST.get("input_value")
    >             platform = request.POST.get("platform")
    >     
    >             if not input_value:
    >                 return JsonResponse({"error": "ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"}, status=400)
    >             
    >             if not platform:
    >                 return JsonResponse({"error": "ê²€ìƒ‰ í”Œë«í¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!"}, status=400)
    >     
    >             # ì„¸ì…˜ì— ì €ì¥
    >             request.session['platform'] = platform
    >             request.session['input_value'] = input_value
    >     
    >             # airflow_url = "http://airflow_007-airflow-webserver:8080/api/v1/dags/etl_dag_search_songs/dagRuns"
    >             # airflow_url_playlist = "http://airflow_007-airflow-webserver:8080/api/v1/dags/etl_dag_playlist/dagRuns"
    >             airflow_url = "http://localhost:8080/api/v1/dags/example_trigger_dag/dagRuns"
    >             username = 'airflow'
    >             password = 'airflow'
    >     
    >             payload = {
    >                 "conf": {"input_value": input_value}
    >             }
    >     
    >             headers = {
    >                 'Content-Type': 'application/json',
    >                 'Accept': 'application/json',
    >             }
    >     
    >             try:
    >                 # response = requests.post(airflow_url, json=payload, headers=headers, auth=HTTPBasicAuth(username, password))
    >                 # response_play = requests.post(airflow_url_playlist, json=payload, headers=headers, auth=HTTPBasicAuth(username, password))
    >                 response = requests.post(airflow_url, json=payload, headers=headers, auth=HTTPBasicAuth(username, password))
    >                 if response.status_code == 200 : #and response_play.status_code == 200:
    >                     time.sleep(5)
    >                     # íŠ¸ë¦¬ê±° ì„±ê³µ í›„ ê²°ê³¼ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
    >                     return redirect('result')  # 'result'ëŠ” ê²°ê³¼ í˜ì´ì§€ì˜ URL ì´ë¦„
    >                 else:
    >                     return JsonResponse({"error": response.json()}, status=response.status_code)
    >             except Exception as e:
    >                 return JsonResponse({"error": str(e)}, status=500)
    >     
    >         return JsonResponse({"error": "Invalid request method"}, status=405)
    >     
    >     def result(request):    
    >         # ì„¸ì…˜ì—ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    >         platform = request.session.get('platform', None)
    >         input_value = request.session.get('input_value', None)
    >     
    >         # ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    >         search_songs = SearchSongs.objects.all()
    >         search_playlists = SearchPlaylist.objects.all()
    >     
    >         # Spotify URL ë³€í™˜
    >         for song in search_songs:
    >             if song.platform == "spotify" and "track" in song.song_url:
    >                 song.transformed_url = song.song_url.replace("track", "embed/track")
    >             else:
    >                 song.transformed_url = song.song_url
    >     
    >         for playlist in search_playlists:
    >             if playlist.platform == "spotify" and "playlist" in playlist.playlist_url:
    >                 playlist.playlist_url = playlist.playlist_url.replace("playlist", "embed/playlist")
    >     
    >         # í…œí”Œë¦¿ìœ¼ë¡œ ë°ì´í„° ì „ë‹¬
    >         context = {
    >             'search_songs': search_songs,
    >             'search_playlists': search_playlists,
    >             'platform': platform,  # í”Œë«í¼ ì •ë³´ ì „ë‹¬
    >             'input_value': input_value,
    >         }
    >         return render(request, 'search/result.html', context)
    >     ```
    >     
    > 
    >          `DBì—ì„œ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ê³¡ ë° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ index.htmlì— ë Œë”ë§`
    > 
    >          `ì‚¬ìš©ì ê²€ìƒ‰ ìš”ì²­ì„ ë°›ì•„ Airflow DAG í˜¸ì¶œ`
    > 
    >          `ê²€ìƒ‰ì–´ì™€ í”Œë«í¼ì— ë”°ë¥¸ ê²°ê³¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ result.htmlì— ë Œë”ë§`
    > 
    > **`ğŸ“‘ Django REST API`**
    > 
    > - [**`Django view ë¡œì§`**]
    >     
    >     ```html
    >     <!-- ê²€ìƒ‰ì–´ ì…ë ¥ ë°›ê¸°: frontend -->
    >     <form method="post" action="/trigger-dag/">
    >         {% csrf_token %}
    >         <input type="text" name="input_value" placeholder="Enter value">
    >         <button type="submit">Trigger DAG</button>
    >     </form>
    >     ```
    >     
    >     ```python
    >     # ì…ë ¥ë°›ì€ ê²€ìƒ‰ì–´ Airflowë¡œ ë³´ë‚´ê¸°: Beckend
    >     import requests
    >     from django.http import JsonResponse
    >     from requests.auth import HTTPBasicAuth
    >     
    >     def trigger_airflow_dag(request):
    >         if request.method == "POST":
    >             input_value = request.POST.get("input_value")  # form-dataì—ì„œ keyê°’ì— í•´ë‹¹í•˜ëŠ” ê°’ ê°€ì ¸ì˜¤ê¸°
    >             
    >             if not input_value:
    >                 return JsonResponse({"error": "No input_value provided"}, status=400)
    >     
    >             airflow_url = "http://localhost:8080/api/v1/dags/example_trigger_dag/dagRuns" # ìš”ì²­ url
    >             username = 'your_username'
    >             password = 'your_password'
    >     
    >             payload = {
    >                 "conf": {"input_value": input_value}
    >             }
    >     
    >             headers = {
    >                 'Content-Type': 'application/json',  # ìš”ì²­ ë³¸ë¬¸ í˜•ì‹ì„ JSONìœ¼ë¡œ ì„¤ì •
    >                 'Accept': 'application/json',         # ì‘ë‹µ í˜•ì‹ë„ JSONìœ¼ë¡œ ì„¤ì •
    >             }
    >     
    >             try:
    >                 response = requests.post(airflow_url, json=payload, headers=headers, auth=HTTPBasicAuth(username, password))
    >     
    >                 if response.status_code == 200:
    >                     return JsonResponse({"message": "DAG triggered successfully!"})
    >                 else:
    >                     return JsonResponse({"error": response.json()}, status=response.status_code)
    >             except Exception as e:
    >                 return JsonResponse({"error": str(e)}, status=500)
    >     
    >         return JsonResponse({"error": "Invalid request method"}, status=405)
    >     
    >     ```
    >     
    > 
    >         `ì‚¬ìš©ì ì…ë ¥ê°’ì„ Django ì›¹ì•±ì—ì„œ ìˆ˜ì§‘`
    > 
    >         `Djangoê°€ Airflow REST API í˜¸ì¶œ: ì…ë ¥ê°’ì„ Airflowì˜ DAGë¡œ ì „ë‹¬`
    > 
    > - [**`Airflow DAG`**]
    >     
    >     ```python
    >     # DAG ì˜ˆì‹œ
    >     from airflow import DAG
    >     from airflow.operators.python import PythonOperator
    >     from datetime import datetime
    >     
    >     def process_input_value(**kwargs):
    >         # Djangoì—ì„œ ì „ë‹¬í•œ conf ê°’ ê°€ì ¸ì˜¤ê¸°
    >         input_value = kwargs['dag_run'].conf.get('input_value', 'default_value')  # ê¸°ë³¸ê°’ ì„¤ì •
    >         print(f"Received input value: {input_value}")
    >         # ì²˜ë¦¬ ë¡œì§ ì¶”ê°€
    >         return f"Processed input value: {input_value}"
    >     
    >     # DAG ì •ì˜
    >     with DAG(
    >         dag_id="example_trigger_dag",
    >         start_date=datetime(2023, 1, 1),  # DAG ì‹œì‘ì¼ ì„¤ì •
    >         schedule_interval=None,  # ìŠ¤ì¼€ì¤„ ì—†ìŒ (ì™¸ë¶€ íŠ¸ë¦¬ê±°ë¡œë§Œ ì‹¤í–‰)
    >         catchup=False,  # ë°±í•„ ì‹¤í–‰ ë°©ì§€
    >     ) as dag:
    >         process_task = PythonOperator(
    >             task_id="process_input_value",
    >             python_callable=process_input_value,
    >             provide_context=True,  # context ì „ë‹¬
    >         )
    >     ```
    >     
    > 
    >        `Airflow DAGì—ì„œ ì…ë ¥ê°’ ì²˜ë¦¬: dag_run.confë¡œ ì „ë‹¬ëœ ì…ë ¥ê°’ì„ ìˆ˜ì‹ í•˜ê³  ì²˜ë¦¬`
    > 
    
    **í”„ë¡ íŠ¸ì—”ë“œ (Template)**
    
    > **`ğŸ“‘ Template`**
    > 
    > - [**`index.html`**] `(ë©”ì¸ í˜ì´ì§€)`
    >     
    >     ```html
    >     <!DOCTYPE html>
    >     <html lang="en">
    >     <head>
    >         {% load static %}
    >         <meta charset="UTF-8">
    >         <meta name="viewport" content="width=device-width, initial-scale=1.0">
    >         <link rel="stylesheet" type="text/css" href="{% static 'search/css/index.css' %}">
    >         <title>ì˜¥íƒ‘ë°© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</title>
    >     </head>
    >     <body>
    >         <header>
    >             <h1>ì˜¥íƒ‘ë°© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</h1>
    >         </header>
    >     
    >         <main>
    >             <!-- ê²€ìƒ‰ì°½ -->
    >             <form action="{% url 'trigger_dag' %}" method="POST">
    >                 {% csrf_token %}
    >                 <input type="radio" id="youtube" name="platform" value="youtube"> YouTube
    >                 <input type="radio" id="spotify" name="platform" value="spotify"> Spotify
    >                 <input type="text" name="input_value" placeholder="ë…¸ë˜ ì œëª© í˜¹ì€ ê°€ìˆ˜ëª…" required>
    >             </form>
    >     
    >             <!-- ì¸ê¸° ì°¨íŠ¸ -->
    >             <div class="playlist">
    >                 <h2>{{ current_date }} ì¸ê¸° ì°¨íŠ¸</h2>
    >                 <div class="scroll-container">
    >                     {% for song in daily_songs %}
    >                         <div class="scroll-item">
    >                             <a href="{{ song.song_url }}" target="_blank">
    >                                 <img src="{{ song.thumbnail }}" alt="{{ song.song_title }}">
    >                                 <p>{{ song.song_title }}</p>
    >                             </a>
    >                         </div>
    >                     {% endfor %}
    >                 </div>
    >             </div>
    >     
    >             <!-- ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ -->
    >             <div class="playlist">
    >                 <h2>ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</h2>
    >                 <div class="scroll-container">
    >                     {% for playlist in daily_playlists %}
    >                         <div class="scroll-item">
    >                             <iframe src="{{ playlist.playlist_url }}" width="300" height="380"></iframe>
    >                         </div>
    >                     {% endfor %}
    >                 </div>
    >             </div>
    >         </main>
    >     
    >         <footer>
    >             <p>@ made by 007</p>
    >         </footer>
    >     </body>
    >     </html>
    >     
    >     ```
    >     
    > 
    >          `ë…¸ë˜ ê²€ìƒ‰ / í”Œë«í¼ í•„í„° - í•„í„°ì— ë§ëŠ” ê²€ìƒ‰ ê²°ê³¼ ì œê³µ`
    > 
    >          `ì˜¤ëŠ˜ì˜ Youtube/Spotify ì¸ê¸° ì°¨íŠ¸ ë° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œê³µ`
    > 
    > - [**`result.html`**] `(ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€)`
    >     
    >     ```html
    >     <!DOCTYPE html>
    >     <html lang="en">
    >     <head>
    >         {% load static %}
    >         <meta charset="UTF-8">
    >         <meta name="viewport" content="width=device-width, initial-scale=1.0">
    >         <link rel="stylesheet" type="text/css" href="{% static 'search/css/result.css' %}">
    >         <title>ì˜¥íƒ‘ë°© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</title>
    >     </head>
    >     <body>
    >         <!-- í—¤ë” -->
    >         <header>
    >             <h1>ì˜¥íƒ‘ë°© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</h1>
    >         </header>
    >     
    >         <div class="main-container">
    >             <!-- ì‚¬ì´ë“œë°” -->
    >             <aside class="sidebar">
    >                 <p class="sidebar-title">MENU</p>
    >                 <button id="youtube-button" class="{% if platform == 'youtube' %}active{% endif %}">YouTube</button>
    >                 <button id="spotify-button" class="{% if platform == 'spotify' %}active{% endif %}">Spotify</button>
    >             </aside>
    >     
    >             <!-- ë©”ì¸ ì½˜í…ì¸  -->
    >             <div class="main-content">
    >                 <!-- ê²€ìƒ‰ì°½ -->
    >                 <form action="{% url 'trigger_dag' %}" method="POST">
    >                     {% csrf_token %}
    >                     <input type="radio" id="youtube" name="platform" value="youtube"> YouTube
    >                     <input type="radio" id="spotify" name="platform" value="spotify"> Spotify
    >                     <input type="text" name="input_value" placeholder="ë…¸ë˜ ì œëª© í˜¹ì€ ê°€ìˆ˜ëª…" required>
    >                 </form>
    >     
    >                 <!-- ê²€ìƒ‰ê²°ê³¼ -->
    >                 <section class="result-container">
    >                     <!-- YouTube ì¶”ì²œ -->
    >                     {% if platform == 'youtube' %}
    >                         <div id="youtube-section">
    >                             <!-- ì¶”ì²œ ë…¸ë˜ -->
    >                             <div class="youtube-videos-container">
    >                                 <h2>YouTube ì¶”ì²œ ê³¡</h2>
    >                                 {% for song in search_songs %}
    >                                     <div>{{ song.song_title }}</div>
    >                                 {% endfor %}
    >                             </div>
    >                             <!-- ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ -->
    >                             <div class="youtube-playlist-container">
    >                                 <h2>YouTube ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</h2>
    >                                 {% for playlist in search_playlists %}
    >                                     <div>{{ playlist.playlist_title }}</div>
    >                                 {% endfor %}
    >                             </div>
    >                         </div>
    >                     {% endif %}
    >     
    >                     <!-- Spotify ì¶”ì²œ -->
    >                     {% if platform == 'spotify' %}
    >                         <div id="spotify-section">
    >                             <!-- ì¶”ì²œ ë…¸ë˜ -->
    >                             <div class="spotify-recommend-container">
    >                                 <h2>Spotify ì¶”ì²œ ê³¡</h2>
    >                                 {% for song in search_songs %}
    >                                     <div>{{ song.song_title }}</div>
    >                                 {% endfor %}
    >                             </div>
    >                             <!-- ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ -->
    >                             <div class="spotify-playlist-container">
    >                                 <h2>Spotify ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</h2>
    >                                 {% for playlist in search_playlists %}
    >                                     <div>{{ playlist.playlist_title }}</div>
    >                                 {% endfor %}
    >                             </div>
    >                         </div>
    >                     {% endif %}
    >                 </section>
    >             </div>
    >         </div>
    >     
    >         <!-- ëª¨ë‹¬ -->
    >         <div class="modal" id="modal">
    >             <div class="modal-content">
    >                 <h2>ë…¸ë˜ ì¬ìƒ</h2>
    >                 <iframe id="youtube-player"></iframe>
    >             </div>
    >         </div>
    >     
    >         <!-- Toast ë©”ì‹œì§€ -->
    >         <div id="toast" class="toast"></div>
    >     
    >         <!-- JavaScript -->
    >         <script src="{% static 'search/js/result.js' %}"></script>
    >     </body>
    >     </html>
    >     ```
    >     
    > 
    >          `ë…¸ë˜ ì¬ê²€ìƒ‰ / í”Œë«í¼ í•„í„° - í•„í„°ì— ë§ëŠ” ê²€ìƒ‰ ê²°ê³¼ ì œê³µ`
    > 
    >          `í•´ë‹¹ ë…¸ë˜ì˜ Youtube/Spotify ì¶”ì²œ ê³¡ ë° í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œê³µ`
    > 
    >          `Youtube Videoì— ëŒ€í•œ ëª¨ë‹¬ ê¸°ëŠ¥ ì œê³µ - ìŒì•… í”Œë ˆì´ì–´`
    > 
</aside>

## V. ê¸°ëŒ€íš¨ê³¼ ë° í•œê³„ì 

<aside>

### ğŸ‘ğŸ½ ê¸°ëŒ€íš¨ê³¼

1. **í†µí•© ê²€ìƒ‰ìœ¼ë¡œ ì‹œê°„ ì ˆì•½**
    
    > ê¸°ì¡´ì—ëŠ” YouTubeì™€ Spotifyì—ì„œ ì›í•˜ëŠ” ë…¸ë˜ë¥¼ ê°ê° ê²€ìƒ‰í•´ì•¼ ì›í•˜ëŠ” ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ìˆì—ˆìŒ
    > 
    
    > í•´ë‹¹ í”„ë¡œì íŠ¸ë¡œ **`ë‘ í”Œë«í¼ì˜ ë°ì´í„°ë¥¼ í†µí•©ì ìœ¼ë¡œ ì œê³µ`**í•˜ì—¬ **`í•œ ë²ˆì˜ ê²€ìƒ‰`**ìœ¼ë¡œ ê´€ë ¨ëœ ìŒì•…ê³¼ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¶”ì²œ
    > 
2. **ë‹¤ì–‘í•œ ì¶”ì²œ ì½˜í…ì¸  ì œê³µ**
    
    > **YouTube** : ì‚¬ìš©ìê°€ ë§Œë“  ì½˜í…ì¸ (ì»¤ë²„ê³¡, ë¼ì´ë¸Œ ì˜ìƒ ë“± video)ê°€ í’ë¶€
    **Spotify** : ì „ë¬¸ì ìœ¼ë¡œ íë ˆì´íŒ…ëœ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ì œê³µ
    > 
    
    > **`ë‘ í”Œë«í¼ì˜ íŠ¹ì„±ì„ ê²°í•©`**í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ **`ë‹¤ì–‘í•œ ì„ íƒì§€ë¥¼ ì œê³µ`**
    > 
3. **ê²€ìƒ‰ê³¼ ë™ì‹œì— ì¬ìƒ ê°€ëŠ¥**
    
    > ê° í”Œë«í¼ì—ì„œ ì¶”ì²œ ë°›ì€ ë…¸ë˜ë¥¼ **`ì›¹í˜ì´ì§€ì—ì„œ ë°”ë¡œ ì¬ìƒ`**ì´ ê°€ëŠ¥í•˜ë„ë¡ Web UI ì œê³µ
    > 
4. **ê²€ìƒ‰ê³¼ ë™ì‹œì— playlist ì¶”ê°€ ê°€ëŠ¥**
    
    > ê° í”Œë«í¼ì—ì„œ ì¶”ì²œ ë°›ì€ playlistë¥¼ **`ì›¹í˜ì´ì§€ì—ì„œ ë°”ë¡œ í”Œë«í¼ì˜ playlistë¡œ ì¶”ê°€`**í•  ìˆ˜ ìˆë„ë¡ Web UI ì œê³µ
    > 

### â˜ğŸ½ í•œê³„ì  ë° ê°œì„ ì 

1. **ì‚¬ìš©ì ì„ í˜¸ ë°˜ì˜ í•œê³„**
    
    > í˜„ì¬ ì‹œìŠ¤í…œì€ **`ê²€ìƒ‰ì–´ ê¸°ë°˜ì˜ ì¶”ì²œ`**ìœ¼ë¡œ, ê°œë³„ ì‚¬ìš©ìì˜ ì„ í˜¸ë‚˜ ì²­ì·¨ ì´ë ¥ê³¼ ê°™ì€ ì‹¬í™” ì •ë³´ë¥¼ ë°˜ì˜í•˜ê¸° ì–´ë ¤ì›€.
    > 
2. **ë§ì¶¤í˜• ì¶”ì²œ ê¸°ëŠ¥ ì¶”ê°€**
    
    > ì‚¬ìš©ìì˜ ì²­ì·¨ ì´ë ¥, ì¢‹ì•„ìš” ê¸°ë¡, ì¦ê²¨ì°¾ê¸° ë°ì´í„°ë¥¼ ì €ì¥ ë° ë¶„ì„í•˜ì—¬ **`ê°œì¸ ë§ì¶¤í˜• ì¶”ì²œ`** ì œê³µ
    > 
3. **ì¶”ì²œ ì‚¬ì´íŠ¸ í™•ì¥**
    
    > spotify, youtube ì™¸ì— **`ë‹¤ë¥¸ ìŒì› ì‚¬ì´íŠ¸ì˜ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ ë° ì¶”ì²œê³¡`**ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆë„ë¡ api ì‚¬ìš© í™•ì¥
    > 
</aside>

## VI.  ì§„í–‰ê³¼ì • ë° ë¦¬ë·°

<aside>

### **ğŸ”± Strategy**

- êµ¬í˜„í•  ê¸°ëŠ¥ë“¤ì„ ì„¸ ê°€ì§€ë¡œ íŒŒíŠ¸ë¡œ ë¶„ë¥˜í•˜ì—¬ êµ¬í˜„, **`ê° ê¸°ëŠ¥ì— ëŒ€í•œ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ê³  ì´í•´`**
- ë°ì´í„° **`ì¶”ì¶œ(Extract)`**, **`ë³€í™˜(Transform)`**, **`ì ì¬(Load)`** ê³¼ì •ì¸ ETL/ELT ì´í•´ ë° êµ¬í˜„
- **`airflow`** ë° **`docker`** ì‚¬ìš©ë²•ì— ëŒ€í•œ ì´í•´ ë° êµ¬í˜„
- **`django`**ì™€ **`airflow`**ì˜ **`connection`** ë° **`dag trigger`** ì´í•´ ë° êµ¬í˜„


### ğŸ’¯ ê¸°ìˆ ì  ì„±ì·¨ë„

| Practical solution | â˜…â˜…â˜…â˜…â˜… |
| --- | --- |
| Visualization | â˜…â˜…â˜…â˜…â˜… |
| Maintainability | â˜…â˜…â˜…â˜…â˜… |
| Flexibility | â˜…â˜…â˜…â˜…â˜† |
| Integration | â˜…â˜…â˜…â˜…â˜… |
</aside>

</aside>
